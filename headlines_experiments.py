headlines = [
    'Teen boys rescued after spending three days lost in the network of catacombs under Paris https://t.co/yQjfG57uK5 https://t.co/lxFxWNFsbK',
    'Why the White House has a personnel problem https://t.co/9yZKgXEReE https://t.co/71aO1rh4wU',
    'President Trump and his family arrive back at the White House after spending their first weekend at Camp David https://t.co/nlqXxu6hlr',
    "Nevada's governor has vetoed a bill that would have made the state the first to open Medicaid to all residents https://t.co/YIfe10M50t",
    'Iran says it launched missiles into Syria, targeting ISIS fighters in retaliation for June 7th attacks in Tehran https://t.co/3ij8TLrIJQ',
    "French President Emmanuel Macron's centrist party projected to win huge majority in parliament… https://t.co/njWAz82zAh",
    "Amazon's $13.7 billion purchase of Whole Foods has ramifications for both your pantry and your pocketbook https://t.co/mlXJHclUFx",
    "French President Emmanuel Macron's party projected to win huge majority in parliament https://t.co/7wflJwspEm https://t.co/NT6B0UtPFr",
    'Iran says it launched missiles into Syria, targeting ISIS fighters in retaliation for June 7th attacks in Tehran… https://t.co/nrQO0EpGCG',
    'North Korea accused U.S. officials of “mugging” its diplomats at JFK airport by seizing a package they were carrying https://t.co/7dIjtdNMWZ',
    "Here's what you need to know about the French election, and what to look for when polls close on Sunday https://t.co/FAjxkI33om",
    '4 years after an investigation in a Florida town, accusations of domestic violence involving the police persist… https://t.co/B9uFS2ZKHV',
    'President Trump says "I have nothing to do with Russia." Trademarks suggest otherwise. https://t.co/l617RRJiTZ',
    'Opinion: "In my 36 years of existence, my parents have never said \'I love you\' to me or vice versa." https://t.co/9KwN4Y9f0P',
    'Conquest complete https://t.co/oB5RO05Dmt',
    'JUST IN: U.S. military says warplane shot down Syrian aircraft that dropped bombs near U.S.-backed fighters in Syria',
    'Viva Air Peru seen near $5 billion Airbus deal at Paris Airshow https://t.co/ncXBMqIOWa https://t.co/smMnUbjfrj',
    'BREAKING: Security forces have rescued 32 guests from Mali resort under attack by gunmen - Security Ministry spokesman',
    "A380plus - Airbus upgrades world's biggest passenger jet https://t.co/4oyynu68Ee https://t.co/c7Dox9n1wR",
    'A German Shepherd puts a paternal paw on the shoulder of his son in 1948. #FathersDay https://t.co/pPkulFXGQk',
    "VIDEO: Drone footage shows burned-out cars in what Portugal's PM is calling the worst tragedy in decades. https://t.co/VIcBfXh7BW",
    "On Father's Day, we remember the fathers and the sons who served in the White House. https://t.co/eeSFTETaIN",
    "Oh, you're just like your father! Check out the family resemblance in our gallery of celebrity dads and sons.… https://t.co/cF8ReEWfmm",
    'How to parent like a German https://t.co/6QPzJEcO7p',
    'Why you should never sign a cell phone contract again https://t.co/bBmdJF9VgH',
    'Math says this is the perfect age to get married https://t.co/DQt1FTl6Rl',
    'Suspected jihadists attack tourist resort in Mali\nhttps://t.co/keCYkPtyZO',
    "5 signs you're eating too little for how much you work out https://t.co/LBQlASaUnk",
    'The tangled world of digital ads https://t.co/EIfyJWAVhw https://t.co/tLG9gahdCz',
    'Opinion: The oldest of the baby boomers never use the L-word around their sons, writes Mike Kerrigan https://t.co/3isIa4kBY1',
    "Volkswagen sold the Thing in the U.S. for two years in the '70s. One still turns heads in San Francisco https://t.co/3i0YzLLZ2N",
    'Bill de Blasio has become a louder advocate for New York City subway riders https://t.co/BdDniAunn4',
    'London police release footage of charred aftermath of Grenfell Tower inferno that left at least 58 people missing a… https://t.co/VTD7l5eBIs',
    'JUST IN: U.S. F/A-18E Super Hornet shoots down Syrian regime fighter jet south of Taqba, the first such occurrence… https://t.co/TAVrV346an',
    'Fmr. US ambassador to NATO says unpredictability of Trump administration may open opportunities for opponents… https://t.co/iQpv70IHoo',
    "Iran's navy conducts joint exercise with Chinese fleet near the strategic Strait of Hormuz https://t.co/Le8FjpKY1F",
    'Rep. Adam Schiff to @ThisWeekABC: “The president wants to take down Bob Mueller." https://t.co/ceOLaDSb1K https://t.co/Kpa2d49yF0',
    'Pope Francis calls for faithful to not only welcome refugees but personally learn from their stories… https://t.co/kiD6aK4dgG',
    'How "Fat Leonard" bribed the Navy to get U.S. diplomatic immunity https://t.co/HKHvfr4wlT',
    'These photos show what the Soviet Union thought the future would look like https://t.co/860hyVgDIA',
    'Ministry of Security: At least 2 people have been killed. A civilian and a member of the security forces have also been wounded.',
    'The German military is conducting intensive background checks to prevent the return of neo-Nazis to the armed forces https://t.co/k7Nt41jKsw',
    "Malian Forces Respond To 'Ongoing Attack' At Popular Tourist Resort https://t.co/0SPghrLsqG",
    "These young Chicago dads are celebrating an extra-special Father's Day -- they've completed a 12 week course to hel… https://t.co/xvKyYBxBnB",
    'Milwaukee County Sheriff David Clarke no longer candidate for DHS job https://t.co/v6fcXnQAfK https://t.co/wnT2GuX8Pj',
    'Several people injured after a gunman opened fire in a shooting that was broadcast on Facebook Live… https://t.co/jEKaq8OXyR',
    'GOP senators still frustrated with Obamacare repeal bill, still doing nothing about it https://t.co/a7mfFcYXEb https://t.co/5HCZdnWPPN',
    'Is the Muslim Brotherhood a violent organisation? https://t.co/7uOKO3iYX7 https://t.co/gIOVHa8zEs',
    "Qatar won't 'shut gas pipeline to UAE' despite blockade, says chief executive of Qatar Petroleum… https://t.co/cms6mwL609",
    "More than two thousand people attend Kiev's gay pride march amid heavy police presence as nationalist protesters tr… https://t.co/JseWbkp9bQ",
    '#BREAKING US shot down Syrian plane that bombed coalition fighters, according to US military',
    "Three major reforms France's President Macron wants to push through parliament https://t.co/vZ7qdltplw",
    '#UPDATE Two dead as suspected jihadists attack Mali tourist resort https://t.co/XCEK0OIrrN https://t.co/P2NlIFUxuP',
    "The third installment in Disney and Pixar's $1 billion Cars franchise easily took the top spot. https://t.co/njE2nIw9MR",
    'If @ossoff wins #GA6 election he’ll owe some of his victory to suburban women who feel guilty about 2016 results. https://t.co/UC0izMBo78',
    '"For the first time, we thought our future had no limits ... Now I feel like everything is crumbling around me." https://t.co/T5v9saCwv9',
    'On #FathersDay remember dads suffering loss because of police violence https://t.co/DxW84mdAf5 via @USATOpinion',
    'Iran says it launched missiles into Syria, targeting ISIS fighters in retaliation for June 7th attacks in Tehran https://t.co/iuVtnEnfw3',
    "French President Emmanuel Macron's centrist party projected to win huge majority in parliament… https://t.co/H0TLb6IRaW",
    'Teen boys rescued after spending three days lost in the network of catacombs under Paris https://t.co/SCn7dAVfWs https://t.co/N7sFmmJHPe',
    "JUST IN: Shots have been fired at a luxury resort popular with Westerners near Mali's capital… https://t.co/PAHZhFUtrs",
    "'Elite Dangerous' and how to create a space war, one alien arms race at a time https://t.co/s77pcqr0n6 https://t.co/IK9CBoF6le",
    "A teacher took a 'sassy' picture with Donald Trump to recognize gay pride because Trump won't… https://t.co/hGK9WI2aNh",
    "Bernie Sanders says police have not been in contact over Alexandria gunman's links to his campaign… https://t.co/qhh3wbp3iT",
    'A weird encounter in deepest Amazonia https://t.co/UzvQBeHmcZ',
    'Major heatwave in south-west US puts elderly and border-crossers at risk https://t.co/NUPIFJuihJ',
    "'The helpline is hopeless': Grenfell relatives criticise lack of information https://t.co/xTqKQDwIEw",
    '50 best summer wines for 2017 https://t.co/UvdmcIe2z8',
    "At arm's length: readers' photos on the theme of distant https://t.co/Ve2Qs46qVg https://t.co/fCbMy5ksUZ",
    "Surge in Latino homeless population 'a whole new phenomenon' for Los Angeles https://t.co/Dt7rRMLaWY https://t.co/DNvlYw6rTP",
    'Disabled La Puente boy dies in summer school class, leaving family with few answers https://t.co/yUi65p5d4R https://t.co/FCxtmnFyPe',
    'Getty Museum agrees to return 1st century BC sculpture to Italy https://t.co/cubECz9UDm https://t.co/3wPqnx5RFq',
    'Watch Marvel Director Taika Waititi’s clever new anti-racism PSA: https://t.co/2EB33RbvFG https://t.co/zdtXmAIyrP',
    "How all of Trump's emoluments lawsuits will hurt him — even if they don't win: https://t.co/NUiXRyn0sA https://t.co/eycHjt7AYe",
    'Amazon wants you to pick up your deliveries. That’s why it’s buying Whole Foods. https://t.co/XhhRxZwK8g https://t.co/GmNyNuTFFr',
    'So Lorde was definitely running a secret Instagram account devoted to rating onion rings: https://t.co/Ed3UAiQhoW https://t.co/JQAYr4h4V8',
    'Saudi Aramco cleans up financials to bolster valuation https://t.co/PfflbC11CV',
    'Proposal to allow anyone to purchase Medicaid coverage within the Silver State is being closely watched https://t.co/0vo65M9tgy',
    'At 20, Radiohead’s “OK Computer” becomes an album for the Trump era https://t.co/0P0oxCq0lB',
    'I nearly died at the hands of anti-Semitic classmates 20 years ago. This is why we need to actively resist bigotry https://t.co/7tdWr2eA0t',
    'Trump’s reversal of Obama’s Cuba policy only makes it harder for Americans to visit https://t.co/2tiiRF58CF',
    'Explosive growth in bulls**t studies! The latest academic frontier in the age of You Know Who https://t.co/KDAYH1eWAw',
    '“The average Republican doesn’t even know what’s in that legislation”: Bernie Sanders blasts GOP on health care https://t.co/PFOGc1AxVL',
    'Best of Salon: Why we need Tupac now more than ever https://t.co/eHcHJvqOBR',
    'Best of Salon: Why we need Tupac now more than ever https://t.co/rlpkmQefFt',
    'Apparently, it was really hard to find people to fill positions https://t.co/hsmvz1YxiT']


from clean_tweets import Tokenizer
from operator import itemgetter
from collections import defaultdict

tokens_sets = dict()

tokenizer = Tokenizer()
for doc in headlines:
    tmp = list()

    for term in tokenizer.tokenize(doc):
        ent_flag = False
        for token in term:
            if token.ent_type_ != '':
                ent_flag = True
        tmp.append((term, ent_flag))

    tokens_sets[doc] = tmp


docs = defaultdict(list)
for tokens in tokens_sets.values():
    for token, is_ne in tokens:
        if is_ne:
            docs[' '.join(map(lambda term: term.lower_, token))].append(list(map(itemgetter(0), tokens)))


def inter(h1, h2):
    h1_s = set(map(lambda term: ' '.join(map(lambda t: t.lower_, term)), h1))
    h2_s = set(map(lambda term: ' '.join(map(lambda t: t.lower_, term)), h2))

    return h1_s & h2_s


keywords = dict()
for k, tokens_list in docs.items():
    score = 1
    max_match = None

    for i in range(len(tokens_list)):
        for j in range(i + 1, len(tokens_list)):
            h1 = tokens_list[i]
            h2 = tokens_list[j]

            match = inter(h1, h2)
            if len(match) > score:
                score = len(match)
                max_match = match

    keywords[k] = (max_match, score)


sets = defaultdict(int)
for k, (kw, sc) in keywords.items():
    if kw:
        sets[frozenset(kw)] += sc

for k, v in sets.items():
    print(k, v)
